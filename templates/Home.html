{{ template "header.html" .}}

<body>
<div class="container">
    <div class="row justify-content-center pt-5 pb-5 vh-70">
        <div class="col-lg-5 rounded shadow" style="background-color: white;">
            <div class="content p-3">
                <div class="row pt-5">
                    <img class="img-fluid" src="assets/call_center_agent.png">
                </div>
                <div class="row pt-5">
                    <h1 style="color: #0478A7"><strong>Welcome to XLN Support</strong></h1>
                    <p class="text-sm">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                        Sed efficitur libero et orci vulputate gravida. In eget pulvinar ante.
                        Nunc fringilla nisi vitae dui euismod, non pretium est mollis. Nulla.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-1"></div> <!--maintains spacing between -->

        <div class="col-lg-5 rounded shadow overflow-hidden h-75" style="background: white;">
            <script crossorigin="anonymous"
                src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
            <style>
                html,
                body {
                    height: 100%;
                }

                body {
                    margin: 0;
                }

                #webchat {
                    height: 70vh;
                    width: 100%;
                }
                #webchat img {
                    height: 45%;
                    width: 45%;
                }
                #webchat .webchat__render-markdown__external-link-icon {
                    height: 30px;
                    width: 30px;
                }
            </style>
            <div id="webchat" class="chatContainer" role="main" style=""></div>
            <script>
                window.WebChat.renderWebChat(
                    {
                        directLine: window.WebChat.createDirectLine({
                            token: '7Y0xAiT3CWM.mKNBL5XyLw3TloHP2RDvgJlrvkAcpyvVJZVJr9rxzlE'
                        }),
                        styleOptions: {
                            hideUploadButton: true,
                        },
                        userID: 'YOUR_USER_ID',
                        username: 'Web Chat User',
                        locale: 'en-US'
                    },
                    document.getElementById('webchat')
                );
            </script>
            <script>
            // Callback function to handle mutations
            function handleMutation(mutationsList, observer) {
                // Get elements by class name
                const elements = document.getElementsByClassName("webchat__text-content__markdown");
                const elements2 = document.getElementsByClassName("webchat__text-content--is-plain");

                // Convert HTMLCollection to an array and iterate over it
                let A = Array.from(elements)
                let L = A.length;
                if (L > 0) {
                    if (L != Num) {
                        for (i=Num; i < L; i++) {
                            console.log(A[i]);
                            console.log(elements[i].textContent)
                            fetch("http://127.0.0.1:8080/bot-conversation", {
                                method: "POST",
                                body: JSON.stringify({
                                    Message: elements[i].textContent,
                                    IsBot: true,
                                }),
                            headers: {
                                "Content-type": "application/json; charset=UTF-8"
                            }
                        })
                        .then((response) => response.json())
                        .then((json) => console.log(json));
                        }
                        Num = L;
                    }
                }
                // Convert HTMLCollection to an array and iterate over it
                let B = Array.from(elements2)
                let M = A.length;
                if (M > 0) {
                    if (M != Num2) {
                        for (i=Num2; i < M; i++) {
                            console.log(B[i]);
                            console.log(elements2[i].textContent)
                            fetch("http://127.0.0.1:8080/bot-conversation", {
                                method: "POST",
                                body: JSON.stringify({
                                    Message: elements2[i].textContent,
                                    IsBot: false,
                                }),
                            headers: {
                                "Content-type": "application/json; charset=UTF-8"
                            }
                        })
                        .then((response) => response.json())
                        .then((json) => console.log(json));
                        }
                        Num2 = M;
                    }
                }
            }
            var Num = 0;
            var Num2 = 0;
            // Select the target node
            const targetNode = document.body;
            // Options for the observer (which mutations to observe)
            const config = { childList: true, subtree: true };
            // Create a MutationObserver instance linked to the callback function
            const observer = new MutationObserver(handleMutation);
            // Start observing the target node for configured mutations
            observer.observe(targetNode, config);
            </script>

        </div>
    </div>
</div>
</body>
